# ğŸ—ï¸ ARQUITETURA SOCKET.IO - AXOLO

## Diagrama da ImplementaÃ§Ã£o

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         AXOLO MULTIPLAYER ONLINE                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                      SERVIDOR NODE.JS (Port 3001)                     â”‚  â•‘
â•‘  â”‚                                                                        â”‚  â•‘
â•‘  â”‚  â€¢ Express + Socket.IO                                               â”‚  â•‘
â•‘  â”‚  â€¢ Gerencia salas de jogo (Map<roomId, room>)                        â”‚  â•‘
â•‘  â”‚  â€¢ Gerencia jogadores online (Map<socketId, player>)                 â”‚  â•‘
â•‘  â”‚                                                                        â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â•‘
â•‘  â”‚  â”‚ EVENT HANDLERS                                               â”‚    â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ user-online (Lobby)                                        â”‚    â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ create-game (Criar sala)                                   â”‚    â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ accept-invite (Aceitar convite)                            â”‚    â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ start-game (Iniciar partida)                               â”‚    â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ join-room (Entrar na sala de jogo)  â† NOVO                 â”‚    â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ player-move (Movimento)  â† NOVO                            â”‚    â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ player-shoot (Tiro)  â† NOVO                                â”‚    â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ player-hit (Dano)  â† NOVO                                  â”‚    â”‚  â•‘
â•‘  â”‚  â”‚ â€¢ disconnect (DesconexÃ£o)                                    â”‚    â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â•‘
â•‘  â”‚                                                                        â”‚  â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â•‘
â•‘  â”‚  â”‚ BROADCAST LOOP (50ms = 20 FPS)                               â”‚    â”‚  â•‘
â•‘  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚  â•‘
â•‘  â”‚  â”‚ setInterval(() => {                                          â”‚    â”‚  â•‘
â•‘  â”‚  â”‚   rooms.forEach((room) => {                                  â”‚    â”‚  â•‘
â•‘  â”‚  â”‚     playersData = [                                          â”‚    â”‚  â•‘
â•‘  â”‚  â”‚       { id, position, rotation, animation, health, ... }     â”‚    â”‚  â•‘
â•‘  â”‚  â”‚     ]                                                        â”‚    â”‚  â•‘
â•‘  â”‚  â”‚     io.to(room.id).emit(\"update-positions\", playersData)  â”‚    â”‚  â•‘
â•‘  â”‚  â”‚   })                                                         â”‚    â”‚  â•‘
â•‘  â”‚  â”‚ }, 50)                                                       â”‚    â”‚  â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â•‘
â•‘  â”‚                                                                        â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                   â–²                                           â•‘
â•‘                                   â”‚ (WebSocket)                               â•‘
â•‘                                   â”‚                                           â•‘
â•‘     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘     â”‚                             â”‚                             â”‚            â•‘
â•‘  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚            â•‘
â•‘  â”‚  CLIENTE 1 (React + R3F)     â”‚ â”‚ CLIENTE 2 (React + R3F)    â”‚â”‚            â•‘
â•‘  â”‚                              â”‚ â”‚                            â”‚â”‚            â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚            â•‘
â•‘  â”‚  â”‚ useLobbySocket.ts        â”‚â”‚ â”‚â”‚ useLobbySocket.ts        â”‚â”‚            â•‘
â•‘  â”‚  â”‚ (Port 3000 - Lobby)      â”‚â”‚ â”‚â”‚ (Port 3000 - Lobby)      â”‚â”‚            â•‘
â•‘  â”‚  â”‚                          â”‚â”‚ â”‚â”‚                          â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ Connect                â”‚â”‚ â”‚â”‚ â€¢ Connect                â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ user-online            â”‚â”‚ â”‚â”‚ â€¢ user-online            â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ create-game (Host)     â”‚â”‚ â”‚â”‚ â€¢ accept-invite (Guest)  â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ start-game (Host) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â•‘
â•‘  â”‚  â”‚                          â”‚â”‚ â”‚â”‚ â€¢ game-starting          â”‚â”‚            â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚            â•‘
â•‘  â”‚                              â”‚ â”‚                            â”‚            â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚            â•‘
â•‘  â”‚  â”‚ useSocket.js             â”‚â”‚ â”‚â”‚ useSocket.js             â”‚â”‚            â•‘
â•‘  â”‚  â”‚ (Port 3001 - Game)       â”‚â”‚ â”‚â”‚ (Port 3001 - Game)       â”‚â”‚            â•‘
â•‘  â”‚  â”‚                          â”‚â”‚ â”‚â”‚                          â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â—„â”€ update-positions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â•‘
â•‘  â”‚  â”‚ â—„â”€ player-shot       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â•‘
â•‘  â”‚  â”‚ â—„â”€ player-killed    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â•‘
â•‘  â”‚  â”‚                          â”‚â”‚ â”‚â”‚                          â”‚â”‚            â•‘
â•‘  â”‚  â”‚ emit: player-move    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘  â”‚  â”‚ emit: player-shoot   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘  â”‚  â”‚ emit: player-hit     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘  â”‚  â”‚ emit: join-room      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚            â•‘
â•‘  â”‚                              â”‚ â”‚                            â”‚            â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚            â•‘
â•‘  â”‚  â”‚ Experience.jsx           â”‚â”‚ â”‚â”‚ Experience.jsx           â”‚â”‚            â•‘
â•‘  â”‚  â”‚                          â”‚â”‚ â”‚â”‚                          â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ useSocket(roomId)      â”‚â”‚ â”‚â”‚ â€¢ useSocket(roomId)      â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ Renderiza jogadores    â”‚â”‚ â”‚â”‚ â€¢ Renderiza jogadores    â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ Debug Panel (Ping)     â”‚â”‚ â”‚â”‚ â€¢ Debug Panel (Ping)     â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ onFire() â†’ emitShoot   â”‚â”‚ â”‚â”‚ â€¢ onFire() â†’ emitShoot   â”‚â”‚            â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚            â•‘
â•‘  â”‚                              â”‚ â”‚                            â”‚            â•‘
â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚            â•‘
â•‘  â”‚  â”‚ CharacterController.jsx  â”‚â”‚ â”‚â”‚ CharacterController.jsx  â”‚â”‚            â•‘
â•‘  â”‚  â”‚                          â”‚â”‚ â”‚â”‚                          â”‚â”‚            â•‘
â•‘  â”‚  â”‚ LOCAL:                   â”‚â”‚ â”‚â”‚ LOCAL:                   â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ useFrame() â†’           â”‚â”‚ â”‚â”‚ â€¢ useFrame() â†’           â”‚â”‚            â•‘
â•‘  â”‚  â”‚   socket.emitMove()      â”‚â”‚ â”‚â”‚   socket.emitMove()      â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ onIntersectionEnter() â”‚â”‚ â”‚â”‚ â€¢ onIntersectionEnter() â”‚â”‚            â•‘
â•‘  â”‚  â”‚   socket.emitHit()       â”‚â”‚ â”‚â”‚   socket.emitHit()       â”‚â”‚            â•‘
â•‘  â”‚  â”‚                          â”‚â”‚ â”‚â”‚                          â”‚â”‚            â•‘
â•‘  â”‚  â”‚ REMOTO:                  â”‚â”‚ â”‚â”‚ REMOTO:                  â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ Position update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ Animation update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚            â•‘
â•‘  â”‚  â”‚ â€¢ Health update   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚â”‚â”‚            â•‘
â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚            â•‘
â•‘  â”‚                              â”‚ â”‚                            â”‚            â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“Š Fluxo de Dados - Exemplo PrÃ¡tico

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    EXEMPLO: PLAYER 1 ATIRA EM PLAYER 2                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PLAYER 1 (Client)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CharacterController.jsx:        â”‚
â”‚ 1. UsuÃ¡rio clica (mouse down)   â”‚
â”‚ 2. if (isShooting) {            â”‚
â”‚      newBullet = {id, pos, ...}â”‚
â”‚      onFire(newBullet)          â”‚
â”‚    }                             â”‚
â”‚                                 â”‚
â”‚ 3. Experience.jsx:onFire()      â”‚
â”‚    emitShoot({                  â”‚
â”‚      id: 'bullet-123',          â”‚
â”‚      position: [10, 1.5, 5],    â”‚
â”‚      direction: [0.8, 0, 0.6]   â”‚
â”‚    })                            â”‚
â”‚                                 â”‚
â”‚ 4. Socket emit:                 â”‚
â”‚    'player-shoot' â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ WebSocket
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERVER (Node.js)                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5. socket.on('player-shoot', (bulletData) => {                    â”‚
â”‚      socket.to(roomId).emit('player-shot', {                      â”‚
â”‚        id: 'bullet-123',                                            â”‚
â”‚        playerId: 'player-1',                                        â”‚
â”‚        position: [10, 1.5, 5],                                      â”‚
â”‚        direction: [0.8, 0, 0.6],                                    â”‚
â”‚        timestamp: 1234567890                                        â”‚
â”‚      })                                                              â”‚
â”‚    })                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ WebSocket
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                            â”‚
                    â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PLAYER 1                    â”‚  â”‚ PLAYER 2 (Client)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 6. Recebe 'player-shot'     â”‚  â”‚ 6. Recebe 'player-shot'     â”‚
â”‚    (descarta porque Ã© seu   â”‚  â”‚                             â”‚
â”‚    prÃ³prio tiro)            â”‚  â”‚ useSocket.js:               â”‚
â”‚                             â”‚  â”‚ socket.on('player-shot', ..â”‚
â”‚                             â”‚  â”‚                             â”‚
â”‚                             â”‚  â”‚ Experience.jsx:             â”‚
â”‚                             â”‚  â”‚ dispatchEvent('player-shot')â”‚
â”‚                             â”‚  â”‚ (Registra que alguÃ©m atirou)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PRÃ“XIMO: Bullet colide com PLAYER 2
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PLAYER 1 (Client)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 7. Bullet.jsx:              â”‚
â”‚    onIntersectionEnter      â”‚
â”‚    â†’ ColisÃ£o detectada!     â”‚
â”‚                             â”‚
â”‚ 8. CharacterController.jsx: â”‚
â”‚    socket.emitHit(          â”‚
â”‚      targetId: 'player-2',  â”‚
â”‚      damage: 25              â”‚
â”‚    )                         â”‚
â”‚ Bullet Ã© removido localmenteâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ emit: 'player-hit'
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERVER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 9. socket.on('player-hit', (data) â”‚
â”‚   {                                â”‚
â”‚     target = players[targetId]     â”‚
â”‚     target.health -= 25            â”‚
â”‚                                    â”‚
â”‚     if (target.health <= 0) {      â”‚
â”‚       target.deaths += 1           â”‚
â”‚       shooter.kills += 1           â”‚
â”‚                                    â”‚
â”‚       io.to(roomId).emit(          â”‚
â”‚         'player-killed', {         â”‚
â”‚           victimId: 'player-2',    â”‚
â”‚           victimName: 'Player2',   â”‚
â”‚           killerId: 'player-1',    â”‚
â”‚           killerName: 'Player1'    â”‚
â”‚         }                          â”‚
â”‚       )                            â”‚
â”‚                                    â”‚
â”‚       setTimeout(() => {           â”‚
â”‚         respawn(target)            â”‚
â”‚       }, 3000)                     â”‚
â”‚     } else {                       â”‚
â”‚       io.to(roomId).emit(          â”‚
â”‚         'player-health-update', {  â”‚
â”‚           id: 'player-2',          â”‚
â”‚           health: 75               â”‚
â”‚         }                          â”‚
â”‚       )                            â”‚
â”‚     }                              â”‚
â”‚   })                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                        â”‚
     â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PLAYER 1     â”‚     â”‚ PLAYER 2             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ useSocket.js â”‚     â”‚ useSocket.js:        â”‚
â”‚ on: 'player- â”‚     â”‚ on: 'player-killed' â”‚
â”‚ killed'      â”‚     â”‚                      â”‚
â”‚              â”‚     â”‚ Experience.jsx:      â”‚
â”‚ VÃª que matou â”‚     â”‚ myId === victimId   â”‚
â”‚ recebe +1    â”‚     â”‚ â†’ setDead(true)      â”‚
â”‚ kill         â”‚     â”‚ â†’ deaths++           â”‚
â”‚              â”‚     â”‚ â†’ setTimeout respawn â”‚
â”‚              â”‚     â”‚                      â”‚
â”‚              â”‚     â”‚ 3 segundos depois:   â”‚
â”‚              â”‚     â”‚ position = spawn     â”‚
â”‚              â”‚     â”‚ health = 100         â”‚
â”‚              â”‚     â”‚ setDead(false)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ SincronizaÃ§Ã£o de PosiÃ§Ãµes (ContÃ­nua)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          UPDATE-POSITIONS (A cada 50ms)                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SERVER:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

setInterval(() => {
  rooms.forEach((room) => {
    playersData = [
      {
        id: 'socket-1',
        position: {x: 10.5, y: 1.2, z: 5.3},
        rotation: {x: 0, y: 1.57, z: 0},
        animation: 'Run',
        health: 100,
        kills: 2,
        deaths: 0,
        isAlive: true
      },
      {
        id: 'socket-2',
        position: {x: -8.2, y: 1.2, z: 12.1},
        rotation: {x: 0, y: 3.14, z: 0},
        animation: 'Idle',
        health: 75,
        kills: 1,
        deaths: 1,
        isAlive: true
      }
    ]
    
    io.to(room.id).emit('update-positions', playersData)
  })
}, 50)  â† 20 updates por segundo = 1000ms / 50ms = 20 FPS


CLIENT (50ms):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

socket.on('update-positions', (playersData) => {
  setPlayers((prev) => {
    let newPlayers = new Map(prev)
    
    playersData.forEach((playerData) => {
      if (playerData.id !== myId) {  // NÃ£o atualizar a si mesmo
        let existing = newPlayers.get(playerData.id)
        if (existing) {
          // Atualizar apenas dados remotos
          Object.assign(existing, playerData)
        } else {
          newPlayers.set(playerData.id, playerData)
        }
      }
    })
    
    return newPlayers
  })
})


RENDER (60 FPS):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Experience.jsx renderiza:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {remotePlayers.map((player) => (    â”‚
â”‚   <CharacterController               â”‚
â”‚     remotePlayer={player}  â† Dados do jogador remoto
â”‚   />                                 â”‚
â”‚ ))}                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CharacterController.jsx useFrame:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ if (remotePlayer) {                 â”‚
â”‚   rigidbody.setTranslation(         â”‚
â”‚     remotePlayer.position  â† Atualiza cada frame
â”‚   )                                  â”‚
â”‚   character.rotation.y =             â”‚
â”‚     remotePlayer.rotation.y          â”‚
â”‚   setAnimation(                      â”‚
â”‚     remotePlayer.animation           â”‚
â”‚   )                                  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESULTADO: 
Movimento suave mesmo com sincronizaÃ§Ã£o a 20 FPS
(InterpolaÃ§Ã£o automÃ¡tica entre atualizaÃ§Ãµes)
```

---

## ğŸ¯ Estado da Sala

```
Room Data Structure:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{
  id: 'room-1234567890',
  name: 'Battle Arena',
  maxPlayers: 4,
  host: {id: 'socket-1', name: 'Player1', ...},
  players: Map {
    'socket-1': {
      id: 'socket-1',
      socketId: 'socket-1',
      name: 'Player1',
      position: {x: 10, y: 0, z: 10},
      rotation: {x: 0, y: 0.5, z: 0},
      animation: 'Run',
      health: 100,
      maxHealth: 100,
      kills: 3,
      deaths: 1,
      isAlive: true,
      lastShotTime: 1234567890
    },
    'socket-2': {
      id: 'socket-2',
      socketId: 'socket-2',
      name: 'Player2',
      position: {x: -10, y: 0, z: 5},
      rotation: {x: 0, y: 3.14, z: 0},
      animation: 'Idle',
      health: 50,
      maxHealth: 100,
      kills: 1,
      deaths: 2,
      isAlive: true,
      lastShotTime: 1234567850
    }
  },
  status: 'playing'  â† 'waiting' ou 'playing'
}
```

---

**Esta Ã© a arquitetura completa de sincronizaÃ§Ã£o multiplayer!** âœ¨

